<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>مولد الكلمات العربية التسلسلي</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="تطبيق لتوليد جميع الكلمات العربية الممكنة بالتسلسل من حرف واحد حتى 28 حرف">
    <meta name="theme-color" content="#5D5CDE">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="مولد الكلمات العربية">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="مولد الكلمات العربية">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzVENUNERSIvPgo8dGV4dCB4PSIxNiIgeT0iMjIiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpzwvdGV4dD4KPC9zdmc+">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iNDAiIGZpbGw9IiM1RDVDREUiLz4KPHR5eHQgeD0iOTAiIHk9IjEyMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjgwIiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPtin7wvdGV4dD4KPHR5eHQgeD0iOTAiIHk9IjUwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7Ygp2YYTYvdGV4dD4KPC9zdmc+">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogItin2YXZiNmE2K/Yp9mE2YPZhNmF2KfYqiDYp9mE2LnYsdio2YrYqSDYp9mE2KrYs9mE2LPZhNmKIiwKICAic2hvcnRfbmFtZSI6ICLZhdmI2YTYryDYp9mE2YPZhNmF2KfYqiIsCiAgImRlc2NyaXB0aW9uIjogItin2YbYqtin2Kwg2KfZhNmD2YTZhdin2Kog2KfZhNi52LHYqNmK2Kkg2KfZhNmF2YXZg9mG2Kkg2KjYp9mE2KrYs9mE2LPZhCDZhdmGINmC2LHZgSDZiNin2K3YryDYrdiq2Ykg28 2K3YsdmBINmF2K3YstmI2YHYqSDYp9mE2KrZg9ix2KfYsci4KICAic3RhcnRfdXJsIjogIi4vIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJ0aGVtZV9jb2xvciI6ICIjNUQ1Q0RFIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjRkZGRkZGIiwKICAiY2F0ZWdvcmllcyI6IFsiZWR1Y2F0aW9uIiwgInV0aWxpdGllcyIsICJ0b29scyJdLAogICJsYW5nIjogImFyIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRreUlpQm9aV2xuYUhROUlqRTVNaUlnZG1sbGQwSnZlRDBpTUNBd0lERTVNaUF4T1RJaUlHWnBiR3c5SW01dmJtVWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStDbHh5WldOMElIZHBaSFJvUFNJeE9USWlJR2hsYVdkb2REMGlNVGt5SW0YT0FpSUdacGJHdzlJaU0xUkRWRFJFVWlMejRLUEhSbGVIUWdlRDBpT1RBaUlIazlJakV5TUNJZ1ptOXVkQzFtWVcxcGJIazlJa0Z5YVdGc0lpQm1iMjUwTFhOcGVtVTlJamN3SWlCbWIyNTBMWGRsYVdkb2REMGlZbTlzWkNJZ1ptbHNiRDBpZDJocGRHVWlJSFJsZUhRdFlXNWphRzl5UFNKdGFXUmtiR1VpUGk1YWR6d3ZkR1Y0ZEQ0S1BIUmxlSFFnZUQwaU9UQWlJSGs5SWpVd0lpQm1iMjUwTFdaaGJXbHNlVDBpUVhKcFlXd2lJR1p2Ym5RdGMybDZaVDBpTWpBaUlHWnBiR3c5SW5kb2FYUmxJaUIwWlhoMExXRnVZMmh2Y2owaWJXbGtaR3hsWGk1YmRqd3ZkR1Y0ZEQ0S1BDOXpkbWMr",CiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROUlqVXhNaUlnZG1sbGQwSnZlRDBpTUNBd0lEVXhNaUExTVRJaUlHWnBiR3c5SW01dmJtVWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStDbHh5WldOMElIZHBaSFJvUFNJMU1USWlJR2hsYVdkb2REMGlOVEV5SWlCeWVEMGlOREFpSUdacGJHdzlJaU0xUkRWRFJFVWlMejRLUEhSbGVIUWdlRDBpTWpVMklpQjVQU0l6TnpBaUlHWnZiblF0Wm1GdGFXeDVQU0pCY21saGJDSWdabTl1ZEMxemFYcGxQU0k0TUNJZ1ptOXVkQzEzWldsbmFIUTlJbUp2YkdRaUlHWnBiR3c5SW5kb2FYUmxJaUIwWlhoMExXRnVZMmh2Y2owaWJXbGtaR3hsWGk1cGJqUWVJRDM4TGRHVjRkRDRLUEhSbGVIUWdlRDBpTWpVMklpQjVQU0p4T0RBaUlHWnZiblF0Wm1GdGFXeDVQU0pCY21saGJDSWdmbTl1ZEMxemFYcGxQU0l5TUNJZ1ptbHNiRDBpZDJocGRHVWlJSFJsZUhRdFlXNWphRzl5UFNKdGFXUmtiR1VpUGo1YmRGSWJENGNNQTBLUEM5emRtYysif==",CiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans Arabic', sans-serif;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .word-card {
            transition: all 0.2s ease;
            font-size: 16px;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: rgba(93, 92, 222, 0.3);
        }
        
        .word-card:hover, .word-card:active {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(93, 92, 222, 0.15);
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #5D5CDE;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        .install-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, #5D5CDE, #7C3AED);
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(93, 92, 222, 0.4);
            display: none;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }
        
        .install-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(93, 92, 222, 0.5);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Standalone app styles */
        .standalone-app header {
            padding-top: calc(env(safe-area-inset-top) + 1.5rem);
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .word-card {
                font-size: 14px;
                min-height: 40px;
                padding: 8px;
            }
            
            .install-button {
                bottom: 15px;
                right: 15px;
                padding: 10px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <!-- Install Button -->
    <button id="installBtn" class="install-button">
        <span>📱</span>
        <span>تثبيت التطبيق</span>
    </button>
    
    <!-- Header -->
    <header class="bg-gradient-to-r from-primary to-purple-600 text-white p-6 shadow-lg">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-2xl md:text-4xl font-bold text-center mb-2">مولد الكلمات العربية التسلسلي</h1>
            <p class="text-center text-purple-100 text-sm md:text-base">توليد الكلمات بالترتيب: ا ب ت ث... اا با تا... اب بب تب...</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto p-4 md:p-6">
        <!-- Controls -->
        <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-4 md:p-6 mb-6 md:mb-8 shadow-sm">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium mb-2">الطول الأقصى للكلمة</label>
                    <select id="maxLength" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="1">حرف واحد</option>
                        <option value="2">حرفين</option>
                        <option value="3" selected>ثلاثة أحرف</option>
                        <option value="4">أربعة أحرف</option>
                        <option value="5">خمسة أحرف</option>
                        <option value="6">ستة أحرف</option>
                        <option value="7">سبعة أحرف</option>
                        <option value="8">ثمانية أحرف</option>
                        <option value="10">عشرة أحرف</option>
                        <option value="28">28 حرف (الحد الأقصى)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">عدد الكلمات لكل دفعة</label>
                    <select id="batchSize" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="100">100</option>
                        <option value="500" selected>500</option>
                        <option value="1000">1000</option>
                        <option value="2000">2000</option>
                        <option value="5000">5000</option>
                    </select>
                </div>
                
                <div class="flex items-end">
                    <button id="generateBtn" class="w-full bg-primary hover:bg-purple-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 shadow-md">
                        بدء التوليد التسلسلي
                    </button>
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="mb-4">
                <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2">
                    <span id="currentProgress">الاستعداد للبدء</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                    <div id="progressBar" class="progress-bar bg-primary h-2 rounded-full" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="flex items-center justify-between flex-wrap gap-2">
                <div id="progressInfo" class="text-sm text-gray-600 dark:text-gray-400"></div>
                <div class="flex space-x-2 space-x-reverse">
                    <button id="pauseBtn" class="hidden bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200">
                        إيقاف مؤقت
                    </button>
                    <button id="downloadBtn" class="hidden bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 md:px-6 rounded-lg transition-colors duration-200">
                        تحميل النتائج
                    </button>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div id="statsContainer" class="hidden grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 md:mb-8">
            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                <div class="text-xl md:text-2xl font-bold text-blue-600 dark:text-blue-400" id="totalWords">0</div>
                <div class="text-sm text-blue-600 dark:text-blue-400">إجمالي الكلمات</div>
            </div>
            <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                <div class="text-xl md:text-2xl font-bold text-green-600 dark:text-green-400" id="displayedWords">0</div>
                <div class="text-sm text-green-600 dark:text-green-400">الكلمات المعروضة</div>
            </div>
            <div class="bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4">
                <div class="text-xl md:text-2xl font-bold text-purple-600 dark:text-purple-400" id="currentLength">0</div>
                <div class="text-sm text-purple-600 dark:text-purple-400">طول الكلمة الحالي</div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="hidden text-center py-8">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600 dark:text-gray-400">جاري التوليد...</p>
        </div>

        <!-- Words Container -->
        <div id="wordsContainer" class="grid grid-cols-3 sm:grid-cols-5 md:grid-cols-7 lg:grid-cols-9 xl:grid-cols-12 gap-2 md:gap-3">
        </div>

        <!-- Load More Button -->
        <div id="loadMoreContainer" class="hidden text-center mt-6 md:mt-8">
            <button id="loadMoreBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-8 rounded-lg transition-colors duration-200">
                تحميل المزيد
            </button>
        </div>
    </main>

    <script>
        // Arabic letters in order
        const arabicLetters = [
            'ا', 'ب', 'ت', 'ث', 'ج', 'ح', 'خ', 'د', 'ذ', 'ر', 'ز', 'س', 'ش', 'ص', 'ض', 'ط', 'ظ', 'ع', 'غ', 'ف', 'ق', 'ك', 'ل', 'م', 'ن', 'ه', 'و', 'ي'
        ];
        
        let allWords = [];
        let displayedWords = [];
        let currentIndex = 0;
        let isGenerating = false;
        let isPaused = false;
        let generationProgress = { current: 0, total: 0 };
        let deferredPrompt;

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').style.display = 'flex';
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    document.getElementById('installBtn').style.display = 'none';
                    showCustomAlert('تم تثبيت التطبيق بنجاح! 🎉');
                }
                deferredPrompt = null;
            }
        });

        // Check if app is installed
        window.addEventListener('appinstalled', () => {
            document.getElementById('installBtn').style.display = 'none';
            showCustomAlert('تم تثبيت التطبيق بنجاح! 🎉');
        });

        // Check if running as standalone app
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
            document.body.classList.add('standalone-app');
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const swCode = `
                        const CACHE_NAME = 'arabic-words-generator-v2';
                        const urlsToCache = [
                            './',
                            'https://cdn.tailwindcss.com',
                            'https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap'
                        ];

                        self.addEventListener('install', event => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then(cache => cache.addAll(urlsToCache))
                            );
                        });

                        self.addEventListener('fetch', event => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then(response => {
                                        if (response) {
                                            return response;
                                        }
                                        return fetch(event.request);
                                    })
                            );
                        });
                    `;
                    
                    const blob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(blob);
                    
                    await navigator.serviceWorker.register(swUrl);
                    console.log('Service Worker registered successfully');
                } catch (error) {
                    console.log('Service Worker registration failed:', error);
                }
            });
        }

        // Generate words sequentially from length 1 to maxLength
        function* generateSequentialWords(maxLength) {
            let totalGenerated = 0;
            
            // Start from length 1 up to maxLength
            for (let length = 1; length <= maxLength; length++) {
                const totalForLength = Math.pow(arabicLetters.length, length);
                
                // Generate all combinations for this length
                for (let index = 0; index < totalForLength; index++) {
                    if (isPaused) {
                        yield null; // Signal pause
                        continue;
                    }
                    
                    const word = generateWordFromIndex(index, length);
                    totalGenerated++;
                    
                    yield {
                        word: word,
                        length: length,
                        index: index,
                        totalForLength: totalForLength,
                        totalGenerated: totalGenerated
                    };
                }
            }
        }
        
        // Convert index to word for given length (base-28 conversion)
        function generateWordFromIndex(index, length) {
            let word = '';
            let temp = index;
            
            for (let i = 0; i < length; i++) {
                word = arabicLetters[temp % arabicLetters.length] + word;
                temp = Math.floor(temp / arabicLetters.length);
            }
            
            return word;
        }
        
        // Calculate total words for all lengths up to maxLength
        function calculateTotalWords(maxLength) {
            let total = 0;
            for (let length = 1; length <= maxLength; length++) {
                total += Math.pow(arabicLetters.length, length);
            }
            return total;
        }

        // Generate words sequentially
        async function generateWords() {
            if (isGenerating) return;
            
            isGenerating = true;
            isPaused = false;
            
            const generateBtn = document.getElementById('generateBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const wordsContainer = document.getElementById('wordsContainer');
            const statsContainer = document.getElementById('statsContainer');
            const downloadBtn = document.getElementById('downloadBtn');
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            const currentProgress = document.getElementById('currentProgress');
            
            generateBtn.disabled = true;
            generateBtn.textContent = 'جاري التوليد...';
            pauseBtn.classList.remove('hidden');
            loadingIndicator.classList.remove('hidden');
            wordsContainer.innerHTML = '';
            statsContainer.classList.remove('hidden');
            downloadBtn.classList.add('hidden');
            
            const maxLength = parseInt(document.getElementById('maxLength').value);
            const batchSize = parseInt(document.getElementById('batchSize').value);
            
            try {
                allWords = [];
                displayedWords = [];
                currentIndex = 0;
                
                // Calculate total expected words
                const totalExpected = calculateTotalWords(maxLength);
                generationProgress.total = totalExpected;
                generationProgress.current = 0;
                
                // Update initial statistics
                document.getElementById('totalWords').textContent = totalExpected.toLocaleString();
                document.getElementById('displayedWords').textContent = '0';
                document.getElementById('currentLength').textContent = '1';
                
                // Start generation
                const generator = generateSequentialWords(maxLength);
                let batch = [];
                let lastUpdateTime = Date.now();
                
                while (true) {
                    if (isPaused) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        continue;
                    }
                    
                    const result = generator.next();
                    
                    if (result.done) {
                        // Process final batch
                        if (batch.length > 0) {
                            addWordBatch(batch);
                            batch = [];
                        }
                        break;
                    }
                    
                    if (result.value === null) continue; // Paused
                    
                    const wordData = result.value;
                    allWords.push(wordData.word);
                    batch.push(wordData);
                    generationProgress.current = wordData.totalGenerated;
                    
                    // Update UI every batch or every 100ms
                    const now = Date.now();
                    if (batch.length >= batchSize || now - lastUpdateTime > 100) {
                        addWordBatch(batch);
                        batch = [];
                        
                        // Update progress
                        const percent = Math.round((generationProgress.current / generationProgress.total) * 100);
                        progressBar.style.width = percent + '%';
                        progressPercent.textContent = percent + '%';
                        currentProgress.textContent = `توليد كلمات بطول ${wordData.length} حرف`;
                        document.getElementById('currentLength').textContent = wordData.length;
                        document.getElementById('displayedWords').textContent = allWords.length.toLocaleString();
                        
                        lastUpdateTime = now;
                        
                        // Allow UI to update
                        await new Promise(resolve => setTimeout(resolve, 1));
                    }
                }
                
                // Final updates
                progressBar.style.width = '100%';
                progressPercent.textContent = '100%';
                currentProgress.textContent = 'اكتمل التوليد';
                downloadBtn.classList.remove('hidden');
                
                showCustomAlert(`تم توليد ${allWords.length.toLocaleString()} كلمة بنجاح!`);
                
            } catch (error) {
                showCustomAlert('حدث خطأ أثناء التوليد: ' + error.message);
            } finally {
                isGenerating = false;
                generateBtn.disabled = false;
                generateBtn.textContent = 'بدء التوليد التسلسلي';
                pauseBtn.classList.add('hidden');
                loadingIndicator.classList.add('hidden');
            }
        }
        
        // Add batch of words to display
        function addWordBatch(batch) {
            const wordsContainer = document.getElementById('wordsContainer');
            
            batch.forEach(wordData => {
                const wordCard = document.createElement('div');
                wordCard.className = 'word-card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-2 md:p-3 text-center font-medium shadow-sm hover:shadow-md cursor-pointer fade-in';
                wordCard.textContent = wordData.word;
                wordCard.title = `طول: ${wordData.length}, ترقيم: ${wordData.index + 1}`;
                wordCard.onclick = () => copyToClipboard(wordData.word);
                wordsContainer.appendChild(wordCard);
            });
        }
        
        // Pause/Resume generation
        function togglePause() {
            isPaused = !isPaused;
            const pauseBtn = document.getElementById('pauseBtn');
            
            if (isPaused) {
                pauseBtn.textContent = 'استئناف';
                pauseBtn.className = pauseBtn.className.replace('bg-yellow-600 hover:bg-yellow-700', 'bg-green-600 hover:bg-green-700');
            } else {
                pauseBtn.textContent = 'إيقاف مؤقت';
                pauseBtn.className = pauseBtn.className.replace('bg-green-600 hover:bg-green-700', 'bg-yellow-600 hover:bg-yellow-700');
            }
        }

        // Load more words
        function loadMoreWords() {
            const batchSize = parseInt(document.getElementById('batchSize').value);
            const wordsContainer = document.getElementById('wordsContainer');
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            
            const endIndex = Math.min(currentIndex + batchSize, allWords.length);
            const newWords = allWords.slice(currentIndex, endIndex);
            
            newWords.forEach(word => {
                const wordCard = document.createElement('div');
                wordCard.className = 'word-card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-2 md:p-3 text-center font-medium shadow-sm hover:shadow-md cursor-pointer fade-in';
                wordCard.textContent = word;
                wordCard.onclick = () => copyToClipboard(word);
                wordsContainer.appendChild(wordCard);
            });
            
            displayedWords = displayedWords.concat(newWords);
            currentIndex = endIndex;
            
            // Update displayed words count
            document.getElementById('displayedWords').textContent = displayedWords.length.toLocaleString();
            
            // Show/hide load more button
            if (currentIndex < allWords.length) {
                loadMoreContainer.classList.remove('hidden');
            } else {
                loadMoreContainer.classList.add('hidden');
            }
            
            // Update progress
            const progress = Math.round((currentIndex / allWords.length) * 100);
            document.getElementById('progressInfo').textContent = `تم عرض ${displayedWords.length.toLocaleString()} من ${allWords.length.toLocaleString()} كلمة (${progress}%)`;
        }

        // Copy to clipboard with haptic feedback
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                
                // Haptic feedback on mobile
                if ('vibrate' in navigator) {
                    navigator.vibrate(50);
                }
                
                showCustomAlert('تم نسخ الكلمة: ' + text);
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                showCustomAlert('تم نسخ الكلمة: ' + text);
            }
        }

        // Download results
        function downloadResults() {
            const maxLength = document.getElementById('maxLength').value;
            const timestamp = new Date().toISOString().slice(0, 10);
            const content = allWords.join('\n');
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `arabic_words_sequential_max${maxLength}_${timestamp}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showCustomAlert('تم تحميل الملف بنجاح!');
        }

        // Custom alert function
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4 text-center">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <button class="px-6 py-2 bg-primary text-white hover:bg-purple-600 rounded-lg transition-colors font-semibold" onclick="this.closest('.fixed').remove()">موافق</button>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (modal.parentNode) {
                    modal.remove();
                }
            }, 3000);
        }

        // Network status detection
        function updateNetworkStatus() {
            const statusElement = document.createElement('div');
            statusElement.className = 'fixed top-0 left-0 right-0 text-center py-2 text-sm font-medium z-40';
            
            if (navigator.onLine) {
                statusElement.textContent = '🌐 متصل بالإنترنت';
                statusElement.className += ' bg-green-500 text-white';
            } else {
                statusElement.textContent = '📱 وضع عدم الاتصال - التطبيق يعمل محلياً';
                statusElement.className += ' bg-orange-500 text-white';
            }
            
            document.body.appendChild(statusElement);
            setTimeout(() => statusElement.remove(), 2000);
        }

        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);

        // Event listeners
        document.getElementById('generateBtn').addEventListener('click', generateWords);
        document.getElementById('pauseBtn').addEventListener('click', togglePause);
        document.getElementById('loadMoreBtn').addEventListener('click', loadMoreWords);
        document.getElementById('downloadBtn').addEventListener('click', downloadResults);

        // Initialize with default values
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('progressInfo').textContent = 'اختر طول الكلمة واضغط "بدء التوليد"';
            
            // Hide install button if already installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                document.getElementById('installBtn').style.display = 'none';
            }
        });

        // Prevent zoom on iOS
        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });

        // Handle orientation change
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                window.scrollTo(0, 0);
            }, 100);
        });
    </script>
</body>
</html>

